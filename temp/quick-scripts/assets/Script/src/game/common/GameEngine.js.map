{"version":3,"sources":["GameEngine.js"],"names":["Object","defineProperty","exports","value","LoginService_1","require","LocalStorage_1","Http_1","GameEventTransmitter_1","DefaultGameEvent_1","GameDataManager_1","Audio_1","ResourcesManager_1","ServerUrls_1","GameEngineClass","loginServerUrl","loacl","_playerIdKey","_loginService","LoginService","_localStorage","LocalStorage","_http","Http","_audio","Audio","get","_instance","enumerable","configurable","prototype","showTips","message","prefab","ResourcesManager","getPrefab","prefabNode","cc","instantiate","tipsScript","getComponent","show","changeScene","scene","director","loadScene","currentScene","getScene","currentSceneNode","getChildByName","doPost","url","params","eventCode","_this","httpPost","ret","log","success","data","GameDataManager","dataChange","GameEventTransmitter","emit","DefaultGameEvent","of","shareGame","wx","shareAppMessage","title","imageUrl","query","userData","playerId","ServerUrls","SHARE_URL","showPrefab","prefabName","panel","addChild","GameEngine","instance"],"mappings":"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","file":"GameEngine.js","sourceRoot":"../../../../../../../assets/Script/src/game/common","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar LoginService_1 = require(\"./service/LoginService\");\nvar LocalStorage_1 = require(\"../../core/common/LocalStorage\");\nvar Http_1 = require(\"../../core/net/Http\");\nvar GameEventTransmitter_1 = require(\"../../core/event/GameEventTransmitter\");\nvar DefaultGameEvent_1 = require(\"../../core/event/DefaultGameEvent\");\nvar GameDataManager_1 = require(\"./data/GameDataManager\");\nvar Audio_1 = require(\"../../core/common/Audio\");\nvar ResourcesManager_1 = require(\"../../core/common/ResourcesManager\");\nvar ServerUrls_1 = require(\"../../utils/ServerUrls\");\nvar GameEngineClass = (function () {\n    function GameEngineClass() {\n        this.loginServerUrl = \"https://liubowen.top/dzk/\";\n        this.loacl = false;\n        this._playerIdKey = \"#___player_id__0.2\";\n        this._loginService = new LoginService_1.LoginService();\n        this._localStorage = new LocalStorage_1.LocalStorage();\n        this._http = new Http_1.Http(this.loginServerUrl);\n        this._audio = new Audio_1.Audio(1, 1);\n    }\n    Object.defineProperty(GameEngineClass, \"instance\", {\n        get: function () {\n            if (this._instance == null) {\n                this._instance = new GameEngineClass();\n            }\n            return this._instance;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(GameEngineClass.prototype, \"loginService\", {\n        get: function () {\n            return this._loginService;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(GameEngineClass.prototype, \"localStorage\", {\n        get: function () {\n            return this._localStorage;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(GameEngineClass.prototype, \"http\", {\n        get: function () {\n            return this._http;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(GameEngineClass.prototype, \"audio\", {\n        get: function () {\n            return this._audio;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(GameEngineClass.prototype, \"playerIdKey\", {\n        get: function () {\n            return this._playerIdKey;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    GameEngineClass.prototype.showTips = function (message) {\n        var prefab = ResourcesManager_1.ResourcesManager.getPrefab(\"tips\");\n        var prefabNode = cc.instantiate(prefab);\n        var tipsScript = prefabNode.getComponent(\"TipsScript\");\n        tipsScript.show(message);\n        return tipsScript;\n    };\n    GameEngineClass.prototype.changeScene = function (scene) {\n        cc.director.loadScene(scene);\n    };\n    GameEngineClass.prototype.currentScene = function () {\n        return cc.director.getScene();\n    };\n    GameEngineClass.prototype.currentSceneNode = function () {\n        return cc.director.getScene().getChildByName('Canvas');\n    };\n    GameEngineClass.prototype.doPost = function (url, params, eventCode) {\n        var _this = this;\n        this._http.httpPost(url, params, function (ret) {\n            cc.log(\"url : \" + url + \" , ret : \", ret);\n            if (!ret.success) {\n                _this.showTips(ret.message);\n                return;\n            }\n            var data = ret.data;\n            GameDataManager_1.GameDataManager.dataChange(data);\n            if (eventCode && eventCode != 0) {\n                GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(eventCode, data));\n            }\n        });\n    };\n    GameEngineClass.prototype.shareGame = function () {\n        wx.shareAppMessage({\n            title: \"柚子消消乐，越消越赚钱\",\n            imageUrl: \"https://liubowen.top/dzk-res/share/70005.png\",\n            query: \"sharePlayerId=\" + GameDataManager_1.GameDataManager.userData.playerId\n        });\n        this.doPost(ServerUrls_1.ServerUrls.SHARE_URL, { \"playerId\": GameDataManager_1.GameDataManager.userData.playerId });\n    };\n    GameEngineClass.prototype.showPrefab = function (prefabName) {\n        var prefab = ResourcesManager_1.ResourcesManager.getPrefab(prefabName);\n        if (!prefab) {\n            return;\n        }\n        var panel = cc.instantiate(prefab);\n        if (!panel) {\n            return;\n        }\n        this.currentSceneNode().addChild(panel);\n    };\n    return GameEngineClass;\n}());\nexports.GameEngine = GameEngineClass.instance;\n"]}