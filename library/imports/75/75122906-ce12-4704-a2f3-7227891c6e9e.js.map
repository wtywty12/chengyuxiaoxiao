{"version":3,"sources":["../../../../../../../../assets/Script/src/game/common/service/assets/Script/src/game/common/service/LoginService.js"],"names":["Object","defineProperty","exports","value","GameEngine_1","require","GameSceneHepler_1","ServerUrls_1","StringUtils_1","LoginService","prototype","checkLogin","_this","wx","getSetting","success","res","playerId","GameEngine","localStorage","get","playerIdKey","cc","log","StringUtils","isEmpty","authSetting","checkSession","getUserInfo","fail","login","withCredentials","lang","encryptedData","iv","params","http","httpPost","ServerUrls","GET_USER_URL","response","showTips","message","changeScene","GameSceneHepler","GAME","code","LOGIN_URL","register","REGISTER_URL"],"mappings":"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","file":"LoginService.js","sourceRoot":"../../../../../../../../assets/Script/src/game/common/service","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar GameEngine_1 = require(\"../GameEngine\");\nvar GameSceneHepler_1 = require(\"../helper/GameSceneHepler\");\nvar ServerUrls_1 = require(\"../../../utils/ServerUrls\");\nvar StringUtils_1 = require(\"../../../utils/StringUtils\");\nvar LoginService = (function () {\n    function LoginService() {\n    }\n    LoginService.prototype.checkLogin = function () {\n        var _this = this;\n        wx.getSetting({\n            success: function (res) {\n                var playerId = GameEngine_1.GameEngine.localStorage.get(GameEngine_1.GameEngine.playerIdKey);\n                cc.log(\"wx.getSetting playerId: \" + playerId + \" , res: \", res);\n                cc.log(\"!res.authSetting['scope.userInfo']: \" + !res['scope.userInfo'] + \" \");\n                cc.log(\"StringUtils.isEmpty(playerId): \" + StringUtils_1.StringUtils.isEmpty(playerId) + \" \");\n                cc.log(\"!res.authSetting['scope.userInfo'] || StringUtils.isEmpty(playerId)  : \" + (!res['scope.userInfo'] ||\n                    StringUtils_1.StringUtils.isEmpty(playerId)));\n                if (!res.authSetting['scope.userInfo'] || StringUtils_1.StringUtils.isEmpty(playerId)) {\n                }\n                else {\n                    wx.checkSession({\n                        success: function (res) {\n                            cc.log(\"wx.checkSession success , res: \", res);\n                            _this.getUserInfo();\n                        },\n                        fail: function (res) {\n                            cc.log(\"wx.checkSession fail , res: \", res);\n                            _this.login();\n                        }\n                    });\n                }\n            }\n        });\n    };\n    LoginService.prototype.getUserInfo = function () {\n        wx.getUserInfo({\n            withCredentials: true,\n            lang: \"zh_CN\",\n            success: function (res) {\n                var encryptedData = res.encryptedData;\n                var iv = res.iv;\n                var params = {\n                    \"playerId\": GameEngine_1.GameEngine.localStorage.get(GameEngine_1.GameEngine.playerIdKey),\n                    \"encryptedData\": encryptedData,\n                    \"iv\": iv\n                };\n                GameEngine_1.GameEngine.http.httpPost(ServerUrls_1.ServerUrls.GET_USER_URL, params, function (response) {\n                    if (!response.success) {\n                        GameEngine_1.GameEngine.showTips(response.message);\n                        return;\n                    }\n                    GameEngine_1.GameEngine.changeScene(GameSceneHepler_1.GameSceneHepler.GAME);\n                });\n            },\n        });\n    };\n    LoginService.prototype.login = function () {\n        wx.login({\n            success: function (res) {\n                cc.log(\"wx.login res: : \", res);\n                var code = res.code;\n                var params = {\n                    \"code\": code,\n                };\n                GameEngine_1.GameEngine.http.httpPost(ServerUrls_1.ServerUrls.LOGIN_URL, params, function (response) {\n                    if (!response.success) {\n                        GameEngine_1.GameEngine.showTips(response.message);\n                        return;\n                    }\n                    GameEngine_1.GameEngine.changeScene(GameSceneHepler_1.GameSceneHepler.GAME);\n                });\n            },\n        });\n    };\n    LoginService.prototype.register = function (encryptedData, iv) {\n        wx.login({\n            success: function (res) {\n                cc.log(\"wx.login res: : \", res);\n                var code = res.code;\n                var params = {\n                    \"code\": code,\n                    \"encryptedData\": encryptedData,\n                    \"iv\": iv\n                };\n                GameEngine_1.GameEngine.http.httpPost(ServerUrls_1.ServerUrls.REGISTER_URL, params, function (response) {\n                    if (!response.success) {\n                        GameEngine_1.GameEngine.showTips(response.message);\n                        return;\n                    }\n                    cc.log(\"register response\", response);\n                    GameEngine_1.GameEngine.changeScene(GameSceneHepler_1.GameSceneHepler.GAME);\n                });\n            },\n        });\n    };\n    return LoginService;\n}());\nexports.LoginService = LoginService;\n"]}