{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\Script\\src\\core\\net/assets\\Script\\src\\core\\net\\NetRouter.js"],"names":["Object","defineProperty","exports","value","DefaultGameEvent_1","require","NetEventCode_1","GameCmdHandlerManager_1","GameEventTransmitter_1","NetRouter","strict","DEFAULT_CIPHER","HEADER_FLAG","MAX_BODY_LEN","HEARTBEAT_CMD","STRICT","prototype","init","_this","socket","binaryType","onopen","event","onConnect","onclose","onDisconnect","onerror","onError","onmessage","cc","log","JSON","stringify","setInterval","send","Uint8Array","GameEventTransmitter","emit","DefaultGameEvent","of","NetEventCode","connect","disconnect","error","onMessage","message","gameCmdHandlerManager","protocol","url","WebSocket","isConnect","readyState","OPEN","bodyMessage"],"mappings":"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","file":"NetRouter.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Script\\src\\core\\net","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar DefaultGameEvent_1 = require(\"../event/DefaultGameEvent\");\r\nvar NetEventCode_1 = require(\"./NetEventCode\");\r\nvar GameCmdHandlerManager_1 = require(\"./GameCmdHandlerManager\");\r\nvar GameEventTransmitter_1 = require(\"../event/GameEventTransmitter\");\r\nvar NetRouter = (function () {\r\n    function NetRouter(strict) {\r\n        this.DEFAULT_CIPHER = [43, 32, 21, 10];\r\n        this.HEADER_FLAG = 0X5362;\r\n        this.MAX_BODY_LEN = 0X7FFFFFFF;\r\n        this.HEARTBEAT_CMD = 0x521f;\r\n        this.STRICT = strict;\r\n    }\r\n    NetRouter.prototype.init = function () {\r\n        var _this = this;\r\n        this.socket.binaryType = \"arraybuffer\";\r\n        this.socket.onopen = function (event) {\r\n            _this.onConnect(event);\r\n        };\r\n        this.socket.onclose = function (event) {\r\n            _this.onDisconnect(event);\r\n        };\r\n        this.socket.onerror = function (event) {\r\n            _this.onError(event);\r\n        };\r\n        this.socket.onmessage = function (event) {\r\n            cc.log(\"socket.onmessage \" + JSON.stringify(event));\r\n        };\r\n        setInterval(function () {\r\n            _this.send(_this.HEARTBEAT_CMD, new Uint8Array(0));\r\n        }, 5 * 1000);\r\n    };\r\n    NetRouter.prototype.onConnect = function (event) {\r\n        cc.log(\"net connect event:\", event);\r\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(NetEventCode_1.NetEventCode.connect));\r\n    };\r\n    NetRouter.prototype.onDisconnect = function (event) {\r\n        cc.log(\"net disconnect event:\", event);\r\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(NetEventCode_1.NetEventCode.disconnect));\r\n    };\r\n    NetRouter.prototype.onError = function (event) {\r\n        cc.log(\"net error event:\", event);\r\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(NetEventCode_1.NetEventCode.error));\r\n    };\r\n    NetRouter.prototype.onMessage = function (message) {\r\n        cc.log(\"net on message, message: \", message);\r\n        GameCmdHandlerManager_1.gameCmdHandlerManager.onMessage(message.protocol, message);\r\n    };\r\n    NetRouter.prototype.connect = function (url) {\r\n        this.socket = new WebSocket(url);\r\n        this.init();\r\n    };\r\n    NetRouter.prototype.isConnect = function () {\r\n        return typeof (this.socket.readyState) != \"undefined\" &&\r\n            this.socket.readyState == WebSocket.OPEN;\r\n    };\r\n    NetRouter.prototype.send = function (protocol, bodyMessage) {\r\n        if (bodyMessage === void 0) { bodyMessage = null; }\r\n        if (!this.isConnect()) {\r\n            cc.log(\"net not Connect\");\r\n            return;\r\n        }\r\n    };\r\n    return NetRouter;\r\n}());\r\nexports.NetRouter = NetRouter;\r\n"]}