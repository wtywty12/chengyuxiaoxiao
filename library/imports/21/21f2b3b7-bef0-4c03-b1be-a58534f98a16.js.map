{"version":3,"sources":["../../../../../../../assets/Script/src/core/net/assets/Script/src/core/net/NetRouter.js"],"names":["Object","defineProperty","exports","value","DefaultGameEvent_1","require","NetEventCode_1","GameCmdHandlerManager_1","GameEventTransmitter_1","NetRouter","strict","DEFAULT_CIPHER","HEADER_FLAG","MAX_BODY_LEN","HEARTBEAT_CMD","STRICT","prototype","init","_this","socket","binaryType","onopen","event","onConnect","onclose","onDisconnect","onerror","onError","onmessage","cc","log","JSON","stringify","setInterval","send","Uint8Array","GameEventTransmitter","emit","DefaultGameEvent","of","NetEventCode","connect","disconnect","error","onMessage","message","gameCmdHandlerManager","protocol","url","WebSocket","isConnect","readyState","OPEN","bodyMessage"],"mappings":"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","file":"NetRouter.js","sourceRoot":"../../../../../../../assets/Script/src/core/net","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar DefaultGameEvent_1 = require(\"../event/DefaultGameEvent\");\nvar NetEventCode_1 = require(\"./NetEventCode\");\nvar GameCmdHandlerManager_1 = require(\"./GameCmdHandlerManager\");\nvar GameEventTransmitter_1 = require(\"../event/GameEventTransmitter\");\nvar NetRouter = (function () {\n    function NetRouter(strict) {\n        this.DEFAULT_CIPHER = [43, 32, 21, 10];\n        this.HEADER_FLAG = 0X5362;\n        this.MAX_BODY_LEN = 0X7FFFFFFF;\n        this.HEARTBEAT_CMD = 0x521f;\n        this.STRICT = strict;\n    }\n    NetRouter.prototype.init = function () {\n        var _this = this;\n        this.socket.binaryType = \"arraybuffer\";\n        this.socket.onopen = function (event) {\n            _this.onConnect(event);\n        };\n        this.socket.onclose = function (event) {\n            _this.onDisconnect(event);\n        };\n        this.socket.onerror = function (event) {\n            _this.onError(event);\n        };\n        this.socket.onmessage = function (event) {\n            cc.log(\"socket.onmessage \" + JSON.stringify(event));\n        };\n        setInterval(function () {\n            _this.send(_this.HEARTBEAT_CMD, new Uint8Array(0));\n        }, 5 * 1000);\n    };\n    NetRouter.prototype.onConnect = function (event) {\n        cc.log(\"net connect event:\", event);\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(NetEventCode_1.NetEventCode.connect));\n    };\n    NetRouter.prototype.onDisconnect = function (event) {\n        cc.log(\"net disconnect event:\", event);\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(NetEventCode_1.NetEventCode.disconnect));\n    };\n    NetRouter.prototype.onError = function (event) {\n        cc.log(\"net error event:\", event);\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(NetEventCode_1.NetEventCode.error));\n    };\n    NetRouter.prototype.onMessage = function (message) {\n        cc.log(\"net on message, message: \", message);\n        GameCmdHandlerManager_1.gameCmdHandlerManager.onMessage(message.protocol, message);\n    };\n    NetRouter.prototype.connect = function (url) {\n        this.socket = new WebSocket(url);\n        this.init();\n    };\n    NetRouter.prototype.isConnect = function () {\n        return typeof (this.socket.readyState) != \"undefined\" &&\n            this.socket.readyState == WebSocket.OPEN;\n    };\n    NetRouter.prototype.send = function (protocol, bodyMessage) {\n        if (bodyMessage === void 0) { bodyMessage = null; }\n        if (!this.isConnect()) {\n            cc.log(\"net not Connect\");\n            return;\n        }\n    };\n    return NetRouter;\n}());\nexports.NetRouter = NetRouter;\n"]}