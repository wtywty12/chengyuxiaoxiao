{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\Script\\src\\game\\game/assets\\Script\\src\\game\\game\\GameResult.js"],"names":["Object","defineProperty","exports","value","Tools_1","require","GameManager_1","RecordGrid_1","GameDataManager_1","GameAudio_1","GameResultClass","randomAry","gameTable","chooseView","gameScene","isStartResult","get","_instance","enumerable","configurable","prototype","setView","setGameScene","scene","getIsStartResult","startResult","idiomAry","chooseMap","RecordGrid","getChooseGridMap","endIdiom","isSussess","i","length","idiom","isEqual","j","substring","getGridString","GameAudio","playJudgeRightEffect","reduceLastIdiomAry","playChooseFadeOut","clearRecordData","onSuccessFul","cb1","cc","callFunc","resetChooseData","node","runAction","sequence","delayTime","GameDataManager","gameData","gridEffectTime","onFailed","Tools","getMapLength","getGameTableGridMap","getGridNumber","tableWidth","tableHeight","GameManager","onGameLevelup","playChooseFadeIn","resetTempData","rightTimes","clearChooseGrid","setScore","score","toString","rewardTime","gametime","addScheTimes","playJudgeErrorEffect","restoreIdiom","clearData","onGameOver","GameResult","instance"],"mappings":"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","file":"GameResult.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Script\\src\\game\\game","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Tools_1 = require(\"../../utils/Tools\");\r\nvar GameManager_1 = require(\"./GameManager\");\r\nvar RecordGrid_1 = require(\"../common/model/RecordGrid\");\r\nvar GameDataManager_1 = require(\"../common/data/GameDataManager\");\r\nvar GameAudio_1 = require(\"../common/helper/GameAudio\");\r\nvar GameResultClass = (function () {\r\n    function GameResultClass() {\r\n        this.randomAry = null;\r\n        this.gameTable = null;\r\n        this.chooseView = null;\r\n        this.gameScene = null;\r\n        this.isStartResult = false;\r\n    }\r\n    Object.defineProperty(GameResultClass, \"instance\", {\r\n        get: function () {\r\n            if (this._instance == null) {\r\n                this._instance = new GameResultClass();\r\n            }\r\n            return this._instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GameResultClass.prototype.setView = function (gameTable, chooseView) {\r\n        this.gameTable = gameTable;\r\n        this.chooseView = chooseView;\r\n    };\r\n    GameResultClass.prototype.setGameScene = function (scene) {\r\n        this.gameScene = scene;\r\n    };\r\n    GameResultClass.prototype.getIsStartResult = function () {\r\n        return this.isStartResult;\r\n    };\r\n    GameResultClass.prototype.startResult = function (idiomAry) {\r\n        this.isStartResult = true;\r\n        var chooseMap = RecordGrid_1.RecordGrid.getChooseGridMap();\r\n        var endIdiom = \"\";\r\n        var isSussess = false;\r\n        for (var i = 0; i < idiomAry.length; i++) {\r\n            var idiom = idiomAry[i];\r\n            var isEqual = true;\r\n            for (var j = 0; j < 4; j++) {\r\n                if (idiom.substring(j, j + 1) != chooseMap.get(j).getGridString()) {\r\n                    isEqual = false;\r\n                    break;\r\n                }\r\n            }\r\n            if (isEqual) {\r\n                isSussess = true;\r\n                endIdiom = idiom;\r\n                break;\r\n            }\r\n        }\r\n        if (isSussess) {\r\n            GameAudio_1.GameAudio.playJudgeRightEffect();\r\n            RecordGrid_1.RecordGrid.reduceLastIdiomAry(endIdiom);\r\n            this.chooseView.playChooseFadeOut();\r\n            RecordGrid_1.RecordGrid.clearRecordData();\r\n            this.onSuccessFul();\r\n            var cb1 = cc.callFunc(this.resetChooseData, this);\r\n            this.gameTable.node.runAction(cc.sequence(cc.delayTime(GameDataManager_1.GameDataManager.gameData.gridEffectTime), cb1));\r\n        }\r\n        else {\r\n            this.onFailed();\r\n        }\r\n    };\r\n    GameResultClass.prototype.resetChooseData = function () {\r\n        if (Tools_1.Tools.getMapLength(RecordGrid_1.RecordGrid.getGameTableGridMap()) == 4 * Tools_1.Tools.getGridNumber(this.gameTable.tableWidth, this.gameTable.tableHeight)) {\r\n            GameManager_1.GameManager.onGameLevelup();\r\n        }\r\n        this.chooseView.playChooseFadeIn();\r\n        this.isStartResult = false;\r\n        this.chooseView.resetTempData();\r\n    };\r\n    GameResultClass.prototype.onSuccessFul = function () {\r\n        GameDataManager_1.GameDataManager.gameData.rightTimes++;\r\n        this.chooseView.clearChooseGrid();\r\n        GameDataManager_1.GameDataManager.gameData.setScore();\r\n        this.gameScene.setScore(GameDataManager_1.GameDataManager.gameData.score.toString());\r\n        if (Tools_1.Tools.getMapLength(RecordGrid_1.RecordGrid.getGameTableGridMap()) == 4 * Tools_1.Tools.getGridNumber(this.gameTable.tableWidth, this.gameTable.tableHeight)) {\r\n        }\r\n        else {\r\n            var rewardTime = 1;\r\n            GameDataManager_1.GameDataManager.gameData.gametime = GameDataManager_1.GameDataManager.gameData.gametime + rewardTime;\r\n            this.gameScene.addScheTimes(rewardTime);\r\n        }\r\n    };\r\n    GameResultClass.prototype.onFailed = function () {\r\n        GameAudio_1.GameAudio.playJudgeErrorEffect();\r\n        this.chooseView.restoreIdiom();\r\n        this.clearData();\r\n    };\r\n    GameResultClass.prototype.clearData = function () {\r\n        RecordGrid_1.RecordGrid.clearRecordData();\r\n        this.chooseView.clearChooseGrid();\r\n        this.isStartResult = false;\r\n    };\r\n    GameResultClass.prototype.onGameOver = function () {\r\n        this.clearData();\r\n    };\r\n    return GameResultClass;\r\n}());\r\nexports.GameResult = GameResultClass.instance;\r\n"]}