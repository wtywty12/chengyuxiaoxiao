{"version":3,"sources":["../../../../../../../assets/Script/src/game/game/assets/Script/src/game/game/GameTable.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","exports","value","GameComponent_1","require","DefaultGameListener_1","GameEventCode_1","GameEvent_1","DefaultGameEvent_1","ResourcesManager_1","ccclass","cc","_decorator","GameEventTransmitter_1","Vec2_1","GameDataManager_1","ConfigManager_1","GameTable","_super","_this","apply","grids","Map","tableWidth","tableHeight","initStoneNum","gridPrefab","timer","isOver","startSpd","joinCheckSpd","startGame","gridOnClickEventListener","event","defaultEvent","GameEvent","cast","coordinate","data","checkPiece","checkNextLevel","load","parseInt","ConfigManager","base","INIT_EMPTY","ResourcesManager","getPrefab","addListener","DefaultGameListener","of","GameEventCode","GRID_ON_CLICK_EVENT","initSpdData","createTable","initLevelStones","initTimer","unload","GameDataManager","gameData","spd","checkPointDataMap","get","sumCell","nextSpdNeedCreateGrid","getPassCheck","haveRemoveGrid","log","cellInterval","schedule","randomCreateStone","changeTimer","unschedule","y","x","vec2","Vec2","createGameGrid","node","instantiate","gameGrid","getComponent","init","addChild","set","toNumber","getFreeGrids","freeGrids","forEach","isFree","push","checkGameOver","GameEventTransmitter","emit","DefaultGameEvent","GAME_OVER_EVENT","stoneType","generatedStoneType","createStone","num","Math","round","random","checkNextSpd","addSpd","ADD_SPEED_EVENT","clearTable","killStone","j","addLevel","isPassGame","PASS_GAME_EVENT","clearInterval","ADD_LEVEL_EVENT","checkDispel","up","down","left","right","upType","getType","downType","leftType","rightType","removeUp","removeDown","removeLeft","removeRight","addScore","level","ADD_SCORE_EVENT","upGrid","downGrid","leftGrid","rightGrid","isPassCheck","playAnimation","parents","type","bgStr","image","getImage","node1","Node","sprite1","addComponent","Sprite","spriteFrame","position","actionTo1","moveBy","v2","callFunc","removeFromParent","seq2","sequence","runAction","GameComponent"],"mappings":"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","file":"GameTable.js","sourceRoot":"../../../../../../../assets/Script/src/game/game","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar GameComponent_1 = require(\"../../core/component/GameComponent\");\nvar DefaultGameListener_1 = require(\"../../core/event/DefaultGameListener\");\nvar GameEventCode_1 = require(\"../common/GameEventCode\");\nvar GameEvent_1 = require(\"../../core/event/GameEvent\");\nvar DefaultGameEvent_1 = require(\"../../core/event/DefaultGameEvent\");\nvar ResourcesManager_1 = require(\"../../core/common/ResourcesManager\");\nvar ccclass = cc._decorator.ccclass;\nvar GameEventTransmitter_1 = require(\"../../core/event/GameEventTransmitter\");\nvar Vec2_1 = require(\"../common/data/Vec2\");\nvar GameDataManager_1 = require(\"../common/data/GameDataManager\");\nvar ConfigManager_1 = require(\"../common/ConfigManager\");\nvar GameTable = (function (_super) {\n    __extends(GameTable, _super);\n    function GameTable() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.grids = new Map();\n        _this.tableWidth = 8;\n        _this.tableHeight = 11;\n        _this.initStoneNum = 28;\n        _this.gridPrefab = null;\n        _this.timer = null;\n        _this.isOver = false;\n        _this.startSpd = 2001;\n        _this.joinCheckSpd = 0;\n        _this.startGame = false;\n        _this.gridOnClickEventListener = function (event) {\n            var defaultEvent = GameEvent_1.GameEvent.cast(event);\n            var coordinate = defaultEvent.data;\n            _this.checkPiece(coordinate);\n            _this.checkNextLevel();\n        };\n        return _this;\n    }\n    GameTable.prototype.load = function () {\n        this.initStoneNum = parseInt(ConfigManager_1.ConfigManager.base.INIT_EMPTY);\n        this.gridPrefab = ResourcesManager_1.ResourcesManager.getPrefab(\"GameGrid\");\n        this.addListener(DefaultGameListener_1.DefaultGameListener.of(GameEventCode_1.GameEventCode.GRID_ON_CLICK_EVENT, this.gridOnClickEventListener));\n        this.initSpdData();\n        this.createTable();\n        this.initLevelStones();\n        this.initTimer();\n    };\n    GameTable.prototype.unload = function () {\n    };\n    GameTable.prototype.initSpdData = function () {\n        GameDataManager_1.GameDataManager.gameData.spd = ConfigManager_1.ConfigManager.checkPointDataMap.get(this.startSpd);\n        GameDataManager_1.GameDataManager.gameData.joinCheckSpd = GameDataManager_1.GameDataManager.gameData.spd.sumCell;\n        GameDataManager_1.GameDataManager.gameData.nextSpdNeedCreateGrid = 0;\n        GameDataManager_1.GameDataManager.gameData.getPassCheck();\n        GameDataManager_1.GameDataManager.gameData.haveRemoveGrid = 0;\n    };\n    GameTable.prototype.initTimer = function () {\n        if (this.isOver) {\n            return;\n        }\n        cc.log(\"时间   ：\", GameDataManager_1.GameDataManager.gameData.spd.cellInterval / 1000);\n        this.schedule(this.randomCreateStone, GameDataManager_1.GameDataManager.gameData.spd.cellInterval / 1000);\n    };\n    GameTable.prototype.changeTimer = function () {\n        this.unschedule(this.randomCreateStone);\n        this.initTimer();\n    };\n    GameTable.prototype.createTable = function () {\n        for (var y = 0; y < this.tableHeight; y++) {\n            for (var x = 0; x < this.tableWidth; x++) {\n                var vec2 = new Vec2_1.Vec2(x, y);\n                this.createGameGrid(vec2);\n            }\n        }\n    };\n    GameTable.prototype.createGameGrid = function (vec2) {\n        var node = cc.instantiate(this.gridPrefab);\n        var gameGrid = node.getComponent(\"GameGrid\");\n        gameGrid.init(vec2);\n        this.node.addChild(gameGrid.node);\n        this.grids.set(vec2.toNumber(), gameGrid);\n    };\n    GameTable.prototype.getFreeGrids = function () {\n        var freeGrids = new Array();\n        this.grids.forEach(function (value) {\n            if (value.isFree()) {\n                freeGrids.push(value);\n            }\n        });\n        return freeGrids;\n    };\n    GameTable.prototype.checkGameOver = function () {\n        if (this.getFreeGrids().length != 0) {\n            return;\n        }\n        this.isOver = true;\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(GameEventCode_1.GameEventCode.GAME_OVER_EVENT));\n        cc.log(\"game over ...\");\n    };\n    GameTable.prototype.randomCreateStone = function () {\n        var stoneType = this.generatedStoneType();\n        this.createStone(stoneType);\n        this.checkGameOver();\n    };\n    GameTable.prototype.createStone = function (stoneType) {\n        var freeGrids = this.getFreeGrids();\n        if (freeGrids.length == 0) {\n            return;\n        }\n        var num = Math.round(Math.random() * (freeGrids.length - 1));\n        var gameGrid = freeGrids[num];\n        gameGrid.createStone(stoneType);\n        this.checkNextSpd();\n    };\n    GameTable.prototype.checkNextSpd = function () {\n        if (this.startGame) {\n            GameDataManager_1.GameDataManager.gameData.nextSpdNeedCreateGrid += 1;\n            if (GameDataManager_1.GameDataManager.gameData.addSpd()) {\n                this.unschedule(this.randomCreateStone);\n                GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(GameEventCode_1.GameEventCode.ADD_SPEED_EVENT));\n                this.initTimer();\n            }\n        }\n    };\n    GameTable.prototype.generatedStoneType = function () {\n        return Math.round(Math.random() * 8);\n    };\n    GameTable.prototype.clearTable = function () {\n        this.grids.forEach(function (value) {\n            value.killStone();\n        });\n    };\n    GameTable.prototype.initLevelStones = function () {\n        for (var i = 0; i < this.initStoneNum; i++) {\n            var stoneType = Math.round(Math.random() * 8);\n            for (var j = 0; j < 2; j++) {\n                this.createStone(stoneType);\n            }\n        }\n        this.startGame = true;\n        GameDataManager_1.GameDataManager.gameData.joinCheckSpd = GameDataManager_1.GameDataManager.gameData.spd.sumCell;\n    };\n    GameTable.prototype.addLevel = function () {\n        GameDataManager_1.GameDataManager.gameData.addLevel();\n        if (GameDataManager_1.GameDataManager.gameData.isPassGame()) {\n            GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(GameEventCode_1.GameEventCode.PASS_GAME_EVENT));\n            clearInterval(this.timer);\n        }\n        else {\n            GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(GameEventCode_1.GameEventCode.ADD_LEVEL_EVENT));\n        }\n    };\n    GameTable.prototype.checkDispel = function (up, down, left, right) {\n        var upType = up == null ? 0 : up.getType();\n        var downType = down == null ? 0 : down.getType();\n        var leftType = left == null ? 0 : left.getType();\n        var rightType = right == null ? 0 : right.getType();\n        var removeUp = false;\n        var removeDown = false;\n        var removeLeft = false;\n        var removeRight = false;\n        if (!removeUp && up != null) {\n            if (upType == downType) {\n                removeUp = true;\n                removeDown = true;\n            }\n            if (upType == leftType) {\n                removeUp = true;\n                removeLeft = true;\n            }\n            if (upType == rightType) {\n                removeUp = true;\n                removeRight = true;\n            }\n        }\n        if (!removeDown && down != null) {\n            if (downType == leftType) {\n                removeDown = true;\n                removeLeft = true;\n            }\n            if (downType == rightType) {\n                removeDown = true;\n                removeRight = true;\n            }\n        }\n        if (!removeLeft && left != null) {\n            if (leftType == rightType) {\n                removeLeft = true;\n                removeRight = true;\n            }\n        }\n        var addScore = 0;\n        if (removeUp) {\n            up.killStone();\n            addScore++;\n        }\n        if (removeDown) {\n            down.killStone();\n            addScore++;\n        }\n        if (removeLeft) {\n            left.killStone();\n            addScore++;\n        }\n        if (removeRight) {\n            right.killStone();\n            addScore++;\n        }\n        addScore *= GameDataManager_1.GameDataManager.gameData.level;\n        GameDataManager_1.GameDataManager.gameData.addScore(addScore);\n        GameEventTransmitter_1.GameEventTransmitter.emit(DefaultGameEvent_1.DefaultGameEvent.of(GameEventCode_1.GameEventCode.ADD_SCORE_EVENT, addScore));\n        return !removeUp && !removeDown && !removeLeft && !removeRight;\n    };\n    GameTable.prototype.checkPiece = function (coordinate) {\n        var x = coordinate.x;\n        var y = coordinate.y;\n        var upGrid = null;\n        var downGrid = null;\n        var leftGrid = null;\n        var rightGrid = null;\n        for (var i = y - 1; i >= 0; i--) {\n            var vec2 = new Vec2_1.Vec2(coordinate.x, i);\n            var gameGrid = this.grids.get(vec2.toNumber());\n            if (gameGrid != null && !gameGrid.isFree()) {\n                upGrid = gameGrid;\n                break;\n            }\n        }\n        for (var i = y + 1; i < this.tableHeight; i++) {\n            var vec2 = new Vec2_1.Vec2(coordinate.x, i);\n            var gameGrid = this.grids.get(vec2.toNumber());\n            if (gameGrid != null && !gameGrid.isFree()) {\n                downGrid = gameGrid;\n                break;\n            }\n        }\n        for (var i = x - 1; i >= 0; i--) {\n            var vec2 = new Vec2_1.Vec2(i, coordinate.y);\n            var gameGrid = this.grids.get(vec2.toNumber());\n            if (gameGrid != null && !gameGrid.isFree()) {\n                leftGrid = gameGrid;\n                break;\n            }\n        }\n        for (var i = x + 1; i < this.tableWidth; i++) {\n            var vec2 = new Vec2_1.Vec2(i, coordinate.y);\n            var gameGrid = this.grids.get(vec2.toNumber());\n            if (gameGrid != null && !gameGrid.isFree()) {\n                rightGrid = gameGrid;\n                break;\n            }\n        }\n        if (this.checkDispel(upGrid, downGrid, leftGrid, rightGrid)) {\n            cc.log(\"没有可以消除的方块\");\n            for (var i = 0; i < 3; i++) {\n                var stoneType = Math.round(Math.random() * 8);\n                this.createStone(stoneType);\n                this.checkGameOver();\n            }\n        }\n    };\n    GameTable.prototype.checkNextLevel = function () {\n        if (GameDataManager_1.GameDataManager.gameData.isPassCheck()) {\n            this.startGame = false;\n            this.addLevel();\n            this.clearTable();\n            this.initLevelStones();\n            GameDataManager_1.GameDataManager.gameData.getPassCheck();\n            GameDataManager_1.GameDataManager.gameData.haveRemoveGrid = 0;\n        }\n    };\n    GameTable.prototype.playAnimation = function (parents, type) {\n        var bgStr = \"game_stone_tile_\" + GameDataManager_1.GameDataManager.gameData.level + \"_\" + type;\n        var image = ResourcesManager_1.ResourcesManager.getImage(bgStr);\n        var node1 = new cc.Node();\n        var sprite1 = node1.addComponent(cc.Sprite);\n        sprite1.spriteFrame = image;\n        node1.position = parents.position;\n        var actionTo1 = cc.moveBy(1, cc.v2(10, 200));\n        var callFunc = cc.callFunc(function () {\n            node1.removeFromParent(true);\n        }, this);\n        var seq2 = cc.sequence(actionTo1, callFunc);\n        node1.runAction(seq2);\n    };\n    GameTable = __decorate([\n        ccclass()\n    ], GameTable);\n    return GameTable;\n}(GameComponent_1.GameComponent));\nexports.GameTable = GameTable;\n"]}